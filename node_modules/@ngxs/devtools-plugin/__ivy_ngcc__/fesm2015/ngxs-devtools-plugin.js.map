{"version":3,"file":"ngxs-devtools-plugin.js","sources":["@ngxs/devtools-plugin/src/symbols.ts","@ngxs/devtools-plugin/src/devtools.plugin.ts","@ngxs/devtools-plugin/src/devtools.module.ts"],"names":[],"mappings":"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","sourcesContent":["import { InjectionToken } from '@angular/core';\n\n/**\n * Interface for the redux-devtools-extension API.\n */\nexport interface NgxsDevtoolsExtension {\n  init(state: any): void;\n  send(action: any, state?: any): void;\n  subscribe(fn: (message: NgxsDevtoolsAction) => void): VoidFunction;\n}\n\nexport interface NgxsDevtoolsAction {\n  type: string;\n  payload: any;\n  state: any;\n  id: number;\n  source: string;\n}\n\nexport interface NgxsDevtoolsOptions {\n  /**\n   * The name of the extension\n   */\n  name?: string;\n\n  /**\n   * Whether the dev tools is enabled or note. Useful for setting during production.\n   */\n  disabled?: boolean;\n\n  /**\n   * Max number of entiries to keep.\n   */\n  maxAge?: number;\n\n  /**\n   * Reformat actions before sending to dev tools\n   */\n  actionSanitizer?: (action: any) => void;\n\n  /**\n   * Reformat state before sending to devtools\n   */\n  stateSanitizer?: (state: any) => void;\n}\n\nexport const NGXS_DEVTOOLS_OPTIONS = new InjectionToken('NGXS_DEVTOOLS_OPTIONS');\n","import { Inject, Injectable, Injector, NgZone, OnDestroy, Éµglobal } from '@angular/core';\nimport { getActionTypeFromInstance, NgxsNextPluginFn, NgxsPlugin, Store } from '@ngxs/store';\nimport { tap, catchError } from 'rxjs/operators';\n\nimport {\n  NGXS_DEVTOOLS_OPTIONS,\n  NgxsDevtoolsAction,\n  NgxsDevtoolsExtension,\n  NgxsDevtoolsOptions\n} from './symbols';\n\nconst enum ReduxDevtoolsActionType {\n  Dispatch = 'DISPATCH',\n  Action = 'ACTION'\n}\n\nconst enum ReduxDevtoolsPayloadType {\n  JumpToAction = 'JUMP_TO_ACTION',\n  JumpToState = 'JUMP_TO_STATE',\n  ToggleAction = 'TOGGLE_ACTION',\n  ImportState = 'IMPORT_STATE'\n}\n\n/**\n * Adds support for the Redux Devtools extension:\n * http://extension.remotedev.io/\n */\n@Injectable()\nexport class NgxsReduxDevtoolsPlugin implements OnDestroy, NgxsPlugin {\n  private devtoolsExtension: NgxsDevtoolsExtension | null = null;\n  private readonly globalDevtools =\n    Éµglobal['__REDUX_DEVTOOLS_EXTENSION__'] || Éµglobal['devToolsExtension'];\n\n  private unsubscribe: VoidFunction | null = null;\n\n  constructor(\n    @Inject(NGXS_DEVTOOLS_OPTIONS) private _options: NgxsDevtoolsOptions,\n    private _injector: Injector,\n    private _ngZone: NgZone\n  ) {\n    this.connect();\n  }\n\n  ngOnDestroy(): void {\n    if (this.unsubscribe !== null) {\n      this.unsubscribe();\n    }\n    if (this.globalDevtools) {\n      this.globalDevtools.disconnect();\n    }\n  }\n\n  /**\n   * Lazy get the store for circular dependency issues\n   */\n  private get store(): Store {\n    return this._injector.get<Store>(Store);\n  }\n\n  /**\n   * Middleware handle function\n   */\n  handle(state: any, action: any, next: NgxsNextPluginFn) {\n    if (!this.devtoolsExtension || this._options.disabled) {\n      return next(state, action);\n    }\n\n    return next(state, action).pipe(\n      catchError(error => {\n        const newState = this.store.snapshot();\n        this.sendToDevTools(state, action, newState);\n        throw error;\n      }),\n      tap(newState => {\n        this.sendToDevTools(state, action, newState);\n      })\n    );\n  }\n\n  private sendToDevTools(state: any, action: any, newState: any) {\n    const type = getActionTypeFromInstance(action);\n    // if init action, send initial state to dev tools\n    const isInitAction = type === '@@INIT';\n    if (isInitAction) {\n      this.devtoolsExtension!.init(state);\n    } else {\n      this.devtoolsExtension!.send({ ...action, action: null, type }, newState);\n    }\n  }\n\n  /**\n   * Handle the action from the dev tools subscription\n   */\n  dispatched(action: NgxsDevtoolsAction) {\n    if (action.type === ReduxDevtoolsActionType.Dispatch) {\n      if (\n        action.payload.type === ReduxDevtoolsPayloadType.JumpToAction ||\n        action.payload.type === ReduxDevtoolsPayloadType.JumpToState\n      ) {\n        const prevState = JSON.parse(action.state);\n        // This makes the DevTools and Router plugins friends with each other.\n        // We're checking for the `router` state to exist, and it also should\n        // have the `trigger` property, so we're sure that this is our router\n        // state (coming from `@ngxs/router-plugin`). This enables a time-traveling\n        // feature since it doesn't only restore the state but also allows the `RouterState`\n        // to navigate back when the action is jumped.\n        if (prevState.router && prevState.router.trigger) {\n          prevState.router.trigger = 'devtools';\n        }\n        this.store.reset(prevState);\n      } else if (action.payload.type === ReduxDevtoolsPayloadType.ToggleAction) {\n        console.warn('Skip is not supported at this time.');\n      } else if (action.payload.type === ReduxDevtoolsPayloadType.ImportState) {\n        const {\n          actionsById,\n          computedStates,\n          currentStateIndex\n        } = action.payload.nextLiftedState;\n        this.devtoolsExtension!.init(computedStates[0].state);\n        Object.keys(actionsById)\n          .filter(actionId => actionId !== '0')\n          .forEach(actionId =>\n            this.devtoolsExtension!.send(actionsById[actionId], computedStates[actionId].state)\n          );\n        this.store.reset(computedStates[currentStateIndex].state);\n      }\n    } else if (action.type === ReduxDevtoolsActionType.Action) {\n      const actionPayload = JSON.parse(action.payload);\n      this.store.dispatch(actionPayload);\n    }\n  }\n\n  private connect(): void {\n    if (!this.globalDevtools || this._options.disabled) {\n      return;\n    }\n\n    // The `connect` method adds `message` event listener since it communicates\n    // with an extension through `window.postMessage` and message events.\n    // We handle only 2 events; thus, we don't want to run many change detections\n    // because the extension sends events that we don't have to handle.\n    this.devtoolsExtension = this._ngZone.runOutsideAngular(\n      () => <NgxsDevtoolsExtension>this.globalDevtools.connect(this._options)\n    );\n\n    this.unsubscribe = this.devtoolsExtension.subscribe(action => {\n      if (\n        action.type === ReduxDevtoolsActionType.Dispatch ||\n        action.type === ReduxDevtoolsActionType.Action\n      ) {\n        this._ngZone.run(() => {\n          this.dispatched(action);\n        });\n      }\n    });\n  }\n}\n","import { NgModule, ModuleWithProviders, InjectionToken } from '@angular/core';\nimport { NGXS_PLUGINS } from '@ngxs/store';\n\nimport { NgxsDevtoolsOptions, NGXS_DEVTOOLS_OPTIONS } from './symbols';\nimport { NgxsReduxDevtoolsPlugin } from './devtools.plugin';\n\nexport function devtoolsOptionsFactory(options: NgxsDevtoolsOptions) {\n  return {\n    name: 'NGXS',\n    ...options\n  };\n}\n\nexport const USER_OPTIONS = new InjectionToken('USER_OPTIONS');\n\n@NgModule()\nexport class NgxsReduxDevtoolsPluginModule {\n  static forRoot(\n    options?: NgxsDevtoolsOptions\n  ): ModuleWithProviders<NgxsReduxDevtoolsPluginModule> {\n    return {\n      ngModule: NgxsReduxDevtoolsPluginModule,\n      providers: [\n        {\n          provide: NGXS_PLUGINS,\n          useClass: NgxsReduxDevtoolsPlugin,\n          multi: true\n        },\n        {\n          provide: USER_OPTIONS,\n          useValue: options\n        },\n        {\n          provide: NGXS_DEVTOOLS_OPTIONS,\n          useFactory: devtoolsOptionsFactory,\n          deps: [USER_OPTIONS]\n        }\n      ]\n    };\n  }\n}\n"]}